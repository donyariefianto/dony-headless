<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Form Skema Generator
    </title>
    <link rel="stylesheet" href="/resources/configs/index.css" />
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous">
      
    </script>
    <style>
      .collapsible-content.collapsed {
        display: none;
      }
      
      .type-options {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      
      .type-option {
        padding: 6px 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      
      .type-option.selected {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
      }
    </style>
  </head>
  <body>
    <div class="sidebar-content">
      <form id="formbuilder-generator-form" class="active-form">
        <input type="hidden" id="formbuilder-id" />

        <div class="form-section">
          <h4>
            Info Form Builder
          </h4>
          <div class="form-group">
            <label for="form-name">Nama Form <span class="required">*</span></label>
            <input type="text" id="form-name" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="form-slug">Slug Form <span class="required">*</span></label>
            <input type="text" id="form-slug" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="form-table">Nama Tabel Utama</label>
            <input type="text" id="form-table" class="form-control" />
          </div>
          <div class="form-group">
            <label for="form-submit-label">Label Tombol Submit</label>
            <input type="text" id="form-submit-label" class="form-control" value="Simpan" />
          </div>
        </div>

        <div class="form-section">
          <h4>
            Field Utama
          </h4>
          <div id="main-fields" class="sortable-list">
          </div>
          <button type="button" onclick="addMainField()" class="btn btn-outline-primary btn-add-item">+ Tambah Field</button>
        </div>

        <div class="form-section">
          <h4>
            Subform
          </h4>
          <div class="form-group">
            <label for="subform-table">Nama Tabel Detail</label>
            <input type="text" id="subform-table" class="form-control" />
          </div>
          <div class="form-group">
            <label for="subform-fk">Foreign Key ke Tabel Utama</label>
            <input type="text" id="subform-fk" class="form-control" />
          </div>
          <div class="form-group">
            <label for="subform-label">Label Subform</label>
            <input type="text" id="subform-label" class="form-control" />
          </div>
          <div id="subform-fields" class="sortable-list">
          </div>
          <button type="button" onclick="addSubField()" class="btn btn-outline-primary btn-add-item">+ Tambah Field Subform</button>
        </div>

        <div class="form-section">
          <h4>
            Perhitungan Otomatis
          </h4>
          <div id="calculation-fields" class="sortable-list">
          </div>
          <button type="button" onclick="addCalculation()" class="btn btn-outline-primary btn-add-item">+ Tambah Formula</button>
        </div>

        <div class="form-section">
          <h4>
            Hasil Skema
          </h4>
          <pre id="schema-output">
          </pre>
          <button type="button" onclick="generateSchema()" class="btn btn-primary">ðŸ“¦ Generate Skema JSON</button>
        </div>
      </form>
    </div>

    <script>
      function addMainField() {
        const container = document.getElementById("main-fields");
        container.appendChild(buildFieldWidget("main"));
      }
      
      function addSubField() {
        const container = document.getElementById("subform-fields");
        container.appendChild(buildFieldWidget("sub"));
      }
      
      function buildFieldWidget(type) {
        const fieldId = `field-${Date.now()}-${Math.floor(Math.random() * 1e3)}`;
        const wrapper = document.createElement("div");
        wrapper.className = "field-item";
        wrapper.dataset.id = fieldId;
        wrapper.innerHTML = `
                    <div class="field-header">
                      <span class="title"><span class="field-name-display">Field Baru</span></span>
                      <div class="item-actions">
                        <button type="button" class="remove-item-btn" onclick="this.closest('.field-item').remove()"><i class="fas fa-trash"></i></button>
                        <button type="button" class="toggle-collapse-btn" onclick="toggleCollapse(this)"><i class="fas fa-chevron-up"></i></button>
                      </div>
                    </div>
                    <div class="collapsible-content">
                      <div class="form-group">
                        <label for="${fieldId}-name">Nama Field <span class="required">*</span></label>
                        <input type="text" id="${fieldId}-name" class="field-name form-control" required />
                      </div>
                      <div class="form-group">
                        <label for="${fieldId}-label">Label Field</label>
                        <input type="text" id="${fieldId}-label" class="field-label form-control" />
                      </div>
                      <div class="form-group">
                        <label>Tipe Field</label>
                        <div class="type-options">
                          ${[ "text", "number", "date", "select", "boolean", "media", "enum", ...type === "main" ? [ "calculated" ] : [] ].map((t, i) => {
          const icons = {
            text: "fa-font",
            number: "fa-hashtag",
            date: "fa-calendar-alt",
            select: "fa-list",
            boolean: "fa-toggle-on",
            media: "fa-image",
            enum: "fa-list-ul",
            calculated: "fa-equals"
          };
          const labels = {
            text: "Teks Pendek",
            number: "Angka",
            date: "Tanggal & Waktu",
            select: "Select",
            boolean: "Boolean",
            media: "Media",
            enum: "Enum",
            calculated: "Hitung Otomatis"
          };
          return `
                            <label class="type-option ${i === 0 ? "selected" : ""}" onclick="selectType(this)">
                              <i class="fas ${icons[t]}"></i> ${labels[t]}
                              <input type="radio" name="${fieldId}-type-radio" value="${t}" style="display:none;" ${i === 0 ? "checked" : ""}>
                            </label>`;
        }).join("")}
                        </div>
                      </div>
                      <div class="form-group checkbox-group">
                        <input type="checkbox" id="${fieldId}-required" class="field-required" />
                        <label for="${fieldId}-required">Wajib Diisi</label>
                      </div>
                    </div>`;
        return wrapper;
      }
      
      function addCalculation() {
        const container = document.getElementById("calculation-fields");
        const id = `calc-${Date.now()}-${Math.floor(Math.random() * 1e3)}`;
        const wrapper = document.createElement("div");
        wrapper.className = "field-item";
        wrapper.dataset.id = id;
        wrapper.innerHTML = `
                    <div class="field-header">
                      <span class="title"><span class="field-name-display">Formula Baru</span></span>
                      <div class="item-actions">
                        <button type="button" class="remove-item-btn" onclick="this.closest('.field-item').remove()"><i class="fas fa-trash"></i></button>
                        <button type="button" class="toggle-collapse-btn" onclick="toggleCollapse(this)"><i class="fas fa-chevron-up"></i></button>
                      </div>
                    </div>
                    <div class="collapsible-content">
                      <div class="form-group">
                        <label for="${id}-field">Nama Field Output</label>
                        <input type="text" class="calc-name form-control" id="${id}-field" placeholder="Contoh: total" />
                      </div>
                      <div class="form-group">
                        <label for="${id}-formula">Formula</label>
                        <input type="text" class="calc-formula form-control" id="${id}-formula" placeholder="jumlah * harga_satuan" />
                      </div>
                    </div>
                  `;
        container.appendChild(wrapper);
      }
      
      function toggleCollapse(btn) {
        const content = btn.closest(".field-item").querySelector(".collapsible-content");
        content.classList.toggle("collapsed");
        const icon = btn.querySelector("i");
        icon.classList.toggle("fa-chevron-up");
        icon.classList.toggle("fa-chevron-down");
      }
      
      function selectType(el) {
        const group = el.closest(".type-options");
        group.querySelectorAll(".type-option").forEach(opt => opt.classList.remove("selected"));
        el.classList.add("selected");
        el.querySelector("input[type=radio]").checked = true;
      }
      
      function generateSchema() {
        const schema = {
          slug: document.getElementById("form-slug").value,
          name: document.getElementById("form-name").value,
          table_name: document.getElementById("form-table").value,
          submit_label: document.getElementById("form-submit-label").value,
          fields: [],
          subform: {
            table_name: document.getElementById("subform-table").value,
            foreign_key: document.getElementById("subform-fk").value,
            label: document.getElementById("subform-label").value,
            fields: []
          },
          calculations: Array.from(document.querySelectorAll("#calculation-fields .field-item")).map(div => ({
            field: div.querySelector(".calc-name").value,
            from: "subform",
            formula: div.querySelector(".calc-formula").value
          }))
        };
        document.querySelectorAll("#main-fields .field-item").forEach(div => {
          schema.fields.push({
            name: div.querySelector(".field-name").value,
            label: div.querySelector(".field-label").value,
            type: div.querySelector(".type-option.selected input").value,
            required: div.querySelector(".field-required").checked
          });
        });
        document.querySelectorAll("#subform-fields .field-item").forEach(div => {
          schema.subform.fields.push({
            name: div.querySelector(".field-name").value,
            label: div.querySelector(".field-label").value,
            type: div.querySelector(".type-option.selected input").value
          });
        });
        document.getElementById("schema-output").textContent = JSON.stringify(schema, null, 2);
      }
    </script>
  </body>
</html>
